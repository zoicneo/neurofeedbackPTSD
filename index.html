<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Report: Neurofeedback for PTSD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Application Structure Plan: 
        The SPA is structured thematically to guide users from a foundational understanding of PTSD and Neurofeedback (NF) to its detailed aspects and future outlook.
        1.  **Hero/Introduction:** Briefly introduces PTSD and NF as a promising treatment.
        2.  **Understanding NF:** Explains what NF is, its rationale for PTSD, and key advantages (non-invasive, tolerability). This section aims to provide foundational knowledge.
        3.  **Modalities & Protocols:** Interactive cards/tabs detailing EEG NF, fMRI NF, and fMRI-informed EEG NF. Users can click to explore specific brainwaves, targeted regions, and key protocols (derived from Sec 2 & Table 2). This allows users to dive into the technical "how."
        4.  **Efficacy & Outcomes:** Presents quantitative data on NF's effectiveness using dynamic Chart.js charts (SMDs, remission rates from Table 1 & Sec 3) and textual summaries of improvements in associated symptoms and diverse populations. This section answers "Does it work?". Interactive filters for charts (e.g., by outcome measure) could be added if complexity allows within vanilla JS.
        5.  **Neurological Mechanisms:** Explains how NF modulates brain activity (operant conditioning, network rebalancing) and highlights specific brain changes observed (amygdala, DMN/SN, neuroplasticity from Sec 4). This addresses the "Why it works."
        6.  **Safety & Tolerability:** Summarizes the favorable safety profile, mild AEs, and low dropout rates, comparing them implicitly to other therapies (Sec 5).
        7.  **NF in Context:** Compares NF with other PTSD therapies, discussing limitations of existing treatments and positioning NF as an alternative/adjunctive option (Sec 6). Interactive comparison points could be used.
        8.  **Challenges & Future:** Outlines methodological limitations of current research and key recommendations for future studies (using content from Sec 7 & Table 3). This section addresses "What's next?".
        9.  **Conclusion:** Summarizes the overall promise of NF.
        User flow is intended to be linear (top-to-bottom via scroll) but with focused exploration within sections (e.g., clicking on modalities). This structure was chosen to build understanding progressively, from general concepts to specific details and future implications, making complex information digestible.
    -->
    <!-- Visualization & Content Choices:
        - **Introduction (PTSD & NF basics):** Textual summaries. Goal: Inform. Method: Styled HTML. Interaction: None. Justification: Sets the stage.
        - **Modalities (EEG, fMRI, fMRI-informed EEG):** Interactive cards/tabs. Goal: Organize & Inform. Method: HTML/CSS for structure, JS for tab switching. Content from Sec 2 & Table 2. Interaction: Click to reveal details. Justification: Allows focused exploration of complex options. (NO SVG/Mermaid)
        - **Efficacy Data (SMD, Remission Rates):** Bar charts & Donut chart. Goal: Compare & Inform. Method: Chart.js (Canvas). Data from Sec 3.1 & Table 1. Interaction: Tooltips on hover. Justification: Clear visual comparison of quantitative outcomes. (NO SVG)
        - **Neurological Mechanisms (Brain changes):** Structured text, possibly simple HTML/CSS diagrams (e.g., for operant conditioning flow). Goal: Inform. Method: Styled HTML. Content from Sec 4. Interaction: None or simple hover effects. Justification: Explains complex processes. (NO SVG/Mermaid)
        - **Safety Profile (AEs, Dropout):** Key stats display. Goal: Inform. Method: Styled HTML. Data from Sec 5. Interaction: None. Justification: Highlights key safety aspects.
        - **Comparison with other therapies:** Side-by-side textual comparison points or a simple table. Goal: Compare. Method: Styled HTML. Content from Sec 6. Interaction: None. Justification: Contextualizes NF. (NO SVG)
        - **Limitations & Recommendations Table:** HTML Table. Goal: Organize. Method: Styled HTML. Data from Table 3. Interaction: Potential JS for filtering/sorting if time permits, otherwise static but clear. Justification: Summarizes research gaps. (NO SVG)
        - **Icons:** Unicode characters for visual enhancement (e.g., brain emoji üß†, chart emoji üìä). (NO SVG)
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F5F5F5; color: #333333; }
        .nav-link { transition: color 0.3s ease; }
        .nav-link.active, .nav-link:hover { color: #607D8B; font-weight: 600; }
        .section-card { background-color: #FFFFFF; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); margin-bottom: 2rem; padding: 1.5rem; }
        @media (min-width: 768px) { .section-card { padding: 2rem; } }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .interactive-tab { cursor: pointer; padding: 0.75rem 1.5rem; border-bottom: 2px solid transparent; transition: all 0.3s ease; }
        .interactive-tab.active { border-bottom-color: #607D8B; color: #607D8B; font-weight: 600; }
        .interactive-tab:hover { background-color: #ECEFF1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext { visibility: hidden; width: 160px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px 0; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -80px; opacity: 0; transition: opacity 0.3s; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .sticky-nav { position: -webkit-sticky; position: sticky; top: 0; z-index: 50; background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #455A64; }
        .accent-color { color: #607D8B; }
        .accent-bg { background-color: #607D8B; }
        .stat-box { background-color: #ECEFF1; padding: 1rem; border-radius: 0.5rem; text-align: center; }
        .stat-box h4 { font-size: 1.5rem; font-weight: 700; color: #607D8B; }
        .stat-box p { font-size: 0.9rem; color: #546E7A; }
        .llm-response { background-color: #F0F4F8; border-left: 4px solid #607D8B; padding: 1rem; margin-top: 1.5rem; border-radius: 0.5rem; font-size: 0.95rem; color: #333333; display: none; }
        .llm-response.active { display: block; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid #607D8B; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 0.5rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .question-input { border: 1px solid #ccc; padding: 0.5rem; border-radius: 0.25rem; width: 100%; max-width: 400px; margin-top: 1rem; }
    </style>
</head>
<body class="antialiased">

    <nav id="mainNav" class="sticky-nav py-3">
        <div class="container mx-auto px-4 flex flex-wrap justify-center items-center">
            <ul class="flex flex-wrap justify-center space-x-3 sm:space-x-5 text-sm sm:text-base">
                <li><a href="#home" class="nav-link p-2">Home</a></li>
                <li><a href="#understanding-nf" class="nav-link p-2">Understanding NF</a></li>
                <li><a href="#modalities" class="nav-link p-2">Modalities</a></li>
                <li><a href="#efficacy" class="nav-link p-2">Efficacy</a></li>
                <li><a href="#mechanisms" class="nav-link p-2">Mechanisms</a></li>
                <li><a href="#safety" class="nav-link p-2">Safety</a></li>
                <li><a href="#context" class="nav-link p-2">Context</a></li>
                <li><a href="#future" class="nav-link p-2">Future Research</a></li>
            </ul>
        </div>
    </nav>

    <header id="home" class="bg-slate-700 text-white py-16 sm:py-24 scroll-mt-16">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold mb-6 text-white">Neurofeedback for PTSD</h1>
            <p class="text-lg sm:text-xl md:text-2xl mb-8 max-w-3xl mx-auto text-slate-200">An Interactive Exploration of Evidence-Based Research on Therapeutic Efficacy and Neurological Mechanisms.</p>
            <a href="#understanding-nf" class="accent-bg hover:bg-slate-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition duration-300">Explore the Report</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6">

        <section id="understanding-nf" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-6 text-center">üß† Understanding PTSD & Neurofeedback</h2>
            <p class="text-lg mb-4" id="understanding-nf-text">
                Posttraumatic Stress Disorder (PTSD) is a severe psychiatric condition stemming from exposure to trauma, characterized by intrusive thoughts, avoidance, hyperarousal, and negative mood changes, significantly impairing daily life [1, 7-10]. Many individuals find existing treatments like psychotherapy and pharmacotherapy insufficient, with remission rates often between 30-60% [3]. This highlights a critical need for novel therapeutic approaches.
            </p>
            <p class="text-lg mb-4">
                Neurofeedback (NF) emerges as a specialized, non-invasive biofeedback technique that empowers individuals to self-regulate their brain activity [2, 7, 9, 11]. By providing real-time feedback on brain signals (EEG or fMRI), NF aims to rebalance dysfunctional brain networks implicated in PTSD‚Äîsuch as a hyperactive amygdala and underactive prefrontal cortex‚Äîleading to improvements in core symptoms [3, 5, 13-15]. Its focus on neural regulation, rather than direct trauma re-exposure, along with high tolerability and low dropout rates, positions NF as a vital alternative or adjunctive therapy [2, 4, 6, 7, 16].
            </p>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="understanding-nf">‚ú® Summarize this Section</button>
            <div id="understanding-nf-summary" class="llm-response"></div>

            <div class="mt-8 pt-4 border-t border-gray-200">
                <h3 class="text-xl font-semibold mb-3">‚ú® Ask a Question about PTSD or Neurofeedback</h3>
                <input type="text" id="question-input-understanding" class="question-input" placeholder="e.g., What are the main symptoms of PTSD?">
                <button id="ask-question-understanding-btn" class="bg-indigo-700 hover:bg-indigo-800 text-white font-semibold py-2 px-4 rounded-md mt-2 transition duration-300">Ask Question</button>
                <div id="understanding-question-output" class="llm-response"></div>
            </div>
        </section>

        <section id="modalities" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-8 text-center">üí° Neurofeedback Modalities & Protocols</h2>
            <p class="text-lg mb-6 text-center" id="modalities-text">Neurofeedback utilizes various methods to monitor and modulate brain activity. The primary modalities include EEG-based, fMRI-based, and fMRI-informed EEG neurofeedback. Click on each modality to learn more about its targeted brainwave frequencies, specific brain regions, and key protocols used in PTSD treatment.</p>
            <div class="flex flex-wrap justify-center border-b border-gray-300 mb-6">
                <button class="interactive-tab active" data-tab="eeg-nf">EEG Neurofeedback</button>
                <button class="interactive-tab" data-tab="fmri-nf">fMRI Neurofeedback</button>
                <button class="interactive-tab" data-tab="fmri-informed-eeg-nf">fMRI-informed EEG-NF</button>
            </div>

            <div id="eeg-nf-content" class="tab-content active">
                <h3 class="text-2xl font-semibold mb-4">EEG-Based Neurofeedback (EEG NF)</h3>
                <p class="mb-4">The most common modality, EEG NF uses scalp sensors to measure and provide feedback on electrical brainwave activity, aiming to regulate global neuro-signals and larger-scale brain oscillations [3, 13, 15].</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-lg mb-2">Targeted Brainwave Frequencies:</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Alpha (8-12 Hz):</strong> Promotes calm, alert relaxation; reduced in PTSD [1, 2, 3, 6, 9, 10, 11, 12, 16].</li>
                            <li><strong>Theta (4-7 Hz):</strong> Linked to relaxation and working memory; increased theta/alpha ratio seen in PTSD [2, 6, 11].</li>
                            <li><strong>Beta (13-20 Hz):</strong> For active cognitive engagement, focus; can be targeted for increase or decrease (high beta) [2, 6, 11, 12].</li>
                            <li><strong>SMR (12-15 Hz):</strong> Upregulated for calm, alert states [10, 12].</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg mb-2">Key Protocols & Sites:</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Alpha-Theta Training:</strong> Increases alpha/theta, suppresses beta for relaxation [2, 6, 9]. (e.g., Parietal Lobe - PZ [6])</li>
                            <li><strong>Inhibit Slow/Fast, Reward Mid-Alpha:</strong> Targets specific frequencies, e.g., at Right Temporal Lobe (T4) [2].</li>
                            <li><strong>Beta Wave Enhancement:</strong> E.g., at F4, P4 for attention [10].</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="fmri-nf-content" class="tab-content">
                <h3 class="text-2xl font-semibold mb-4">fMRI-Based Neurofeedback (fMRI NF)</h3>
                <p class="mb-4">Utilizes real-time fMRI (rt-fMRI) to target and modulate activity in deeper brain regions, offering precise control over localized brain activity and networks [2, 3, 5, 7, 13, 14, 17].</p>
                <h4 class="font-semibold text-lg mb-2">Targeted Brain Regions:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Amygdala:</strong> Modulates hyperactivity in this fear-processing center [3, 5, 7, 13, 14, 15, 18].</li>
                    <li><strong>Posterior Cingulate Cortex (PCC):</strong> Downregulates activity related to trauma re-experiencing and self-related emotional processing. PCC downregulation showed broader benefits than amygdala downregulation alone in one study [7, 14, 16, 18].</li>
                    <li><strong>Prefrontal Cortex (PFC) & Hippocampus:</strong> Strengthens emotional regulation networks [3, 5, 15].</li>
                </ul>
            </div>

            <div id="fmri-informed-eeg-nf-content" class="tab-content">
                <h3 class="text-2xl font-semibold mb-4">fMRI-Informed EEG-NF</h3>
                <p class="mb-4">Combines EEG's accessibility with fMRI's precision by using fMRI data (e.g., Electronic Fingerprint - EFP) to guide EEG training, targeting specific subcortical regions [3, 4, 5, 13, 17].</p>
                <h4 class="font-semibold text-lg mb-2">Key Aspects:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Example Device:</strong> Prism for PTSD (FDA-cleared) focuses on amygdala-derived EFP [3, 4].</li>
                    <li><strong>Target Region:</strong> Primarily Amygdala, leveraging fMRI insights for EEG targeting [3, 4, 5, 13, 17].</li>
                    <li><strong>Advantage:</strong> Offers a scalable way to achieve more precise neural targeting typically associated with fMRI.</li>
                </ul>
                <p class="mt-4 text-sm text-gray-600">The evolution towards fMRI-guided and informed techniques aims for more targeted and effective interventions, though EEG NF remains highly relevant and effective, particularly for global brain oscillations [3, 13, 15, 17]. Some meta-analyses suggest EEG NF might be more effective for PTSD symptoms than fMRI NF, highlighting ongoing research nuances [15].</p>
            </div>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="modalities">‚ú® Summarize this Section</button>
            <div id="modalities-summary" class="llm-response"></div>
        </section>

        <section id="efficacy" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-8 text-center">üìä Efficacy & Outcomes</h2>
            <p class="text-lg mb-6 text-center" id="efficacy-text">Neurofeedback demonstrates significant therapeutic potential in reducing PTSD symptoms, with multiple studies reporting clinically meaningful effect sizes and high remission rates, often comparable to or exceeding established treatments [1, 2, 3, 5, 6, 17, 19].</p>
            <div class="grid md:grid-cols-2 gap-8 items-start">
                <div>
                    <h3 class="text-xl font-semibold text-center mb-3">Effect Sizes (SMD/MD)</h3>
                    <div class="chart-container">
                        <canvas id="effectSizeChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-600 mt-2 text-center">SMD: Standardized Mean Difference. MD: Mean Difference. Higher absolute SMD/MD values indicate greater effect. Negative SMD indicates improvement. Sources: [1, 3, 17, 19].</p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-center mb-3">Remission Rates</h3>
                    <div class="chart-container" style="height:280px; max-height:300px;">
                        <canvas id="remissionRateChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-600 mt-2 text-center">Comparison of remission rates between NF groups and control groups or specific study outcomes. Sources: [1, 4, 7, 8, 16].</p>
                </div>
            </div>
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-3">Further Insights on Efficacy:</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li><strong>Sustained Effects:</strong> Benefits are often sustained and can increase at follow-up, suggesting durable therapeutic change [3, 5, 17, 20].</li>
                    <li><strong>Associated Symptoms:</strong> NF also improves anxiety, depression, sleep, affect regulation, and executive functioning [1, 2, 3, 6, 8, 19].</li>
                    <li><strong>Diverse Populations:</strong> Effective across military, civilians, veterans, police, refugees, and children/adolescents [1, 3, 8-10]. Notably effective for complex trauma PTSD [19].</li>
                    <li><strong>Dosage:</strong> More and longer sessions are generally more effective. Protocols often involve 15-24 sessions over several weeks [2, 4, 6, 19].</li>
                </ul>
            </div>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="efficacy">‚ú® Summarize this Section</button>
            <div id="efficacy-summary" class="llm-response"></div>
        </section>

        <section id="mechanisms" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-6 text-center">‚öôÔ∏è Neurological Mechanisms</h2>
            <p class="text-lg mb-6" id="mechanisms-text">Neurofeedback operates via operant conditioning, enabling individuals to self-regulate brain activity. It aims to normalize dysregulated brain patterns, strengthen neural networks, and enhance intrinsic regulatory capacity through real-time feedback and endogenous neuromodulation [2, 3, 4, 6, 11]. This leads to measurable changes in brain function and connectivity.</p>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="stat-box">
                    <h4 class="mb-1">Amygdala Modulation</h4>
                    <p>Reduces hyperactivity in the amygdala, a key fear center [3, 4, 5, 13, 15].</p>
                </div>
                <div class="stat-box">
                    <h4 class="mb-1">Network Rebalancing</h4>
                    <p>Normalizes connectivity in Default Mode (DMN) & Salience Networks (SN) [1, 13].</p>
                </div>
                <div class="stat-box">
                    <h4 class="mb-1">Alpha Rhythm Enhancement</h4>
                    <p>Improves alpha activity, linked to reduced hyperarousal; shifts amygdala connectivity [2, 13, 16].</p>
                </div>
                <div class="stat-box">
                    <h4 class="mb-1">Neuroplasticity</h4>
                    <p>Can induce microstructural changes in gray/white matter with sustained training [6, 13].</p>
                </div>
                 <div class="stat-box md:col-span-2">
                    <h4 class="mb-1">PCC Downregulation</h4>
                    <p>Targeting the Posterior Cingulate Cortex (PCC) has shown reduced reliving/distress and widespread neural normalization, potentially more impactful than amygdala targeting alone in some contexts [16, 18].</p>
                </div>
            </div>
            <p class="text-lg mt-6">These mechanisms suggest NF addresses the underlying neurological dysregulation of PTSD, promoting lasting recovery rather than just symptom relief.</p>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="mechanisms">‚ú® Summarize this Section</button>
            <div id="mechanisms-summary" class="llm-response"></div>

            <button id="explain-mechanisms-btn" class="bg-purple-700 hover:bg-purple-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300">‚ú® Explain in Simpler Terms</button>
            <div id="mechanisms-simple-explanation" class="llm-response"></div>
        </section>

        <section id="safety" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-6 text-center">üõ°Ô∏è Safety Profile & Tolerability</h2>
            <p class="text-lg mb-6" id="safety-text">Neurofeedback is a non-invasive therapy consistently reported to have a favorable safety profile.</p>
            <div class="grid md:grid-cols-2 gap-6 text-center">
                <div class="p-6 bg-green-50 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-700 mb-2">Minimal Adverse Events</h3>
                    <p class="text-gray-700">Most studies report mild or no adverse events. Any reported AEs are typically transient (e.g., temporary fatigue) [4, 6, 7]. No known significant long-term side effects [7].</p>
                </div>
                <div class="p-6 bg-sky-50 rounded-lg">
                    <h3 class="text-xl font-semibold text-sky-700 mb-2">High Tolerability & Low Dropout</h3>
                    <p class="text-gray-700">Dropout rates are consistently low (e.g., 9% in one study, lower than some psychotherapies) [2, 4, 6]. High tolerability makes it suitable for those who struggle with other treatments [3, 6].</p>
                </div>
            </div>
            <p class="text-lg mt-6 text-center">This strong safety and tolerability profile positions NF as a viable option for long-term management and for individuals sensitive to other interventions.</p>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="safety">‚ú® Summarize this Section</button>
            <div id="safety-summary" class="llm-response"></div>
        </section>

        <section id="context" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-6 text-center">üîÑ Neurofeedback in Context</h2>
            <p class="text-lg mb-6" id="context-text">While standard PTSD treatments like psychotherapy and pharmacotherapy are effective for some, many individuals experience residual symptoms or struggle with side effects and high attrition rates [3].</p>
            <div class="bg-amber-50 p-6 rounded-lg">
                <h3 class="text-xl font-semibold text-amber-700 mb-3">NF as an Alternative & Adjunctive Therapy:</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>Targets neural regulation and stabilization, not direct trauma processing, making it suitable for those who find exposure therapy too distressing [2, 16].</li>
                    <li>Effect sizes are comparable to or better than many established psychotherapies and published drug interventions for PTSD [2].</li>
                    <li>Can be effectively used alongside other treatments; one FDA-cleared device is for adjunctive use [3, 9, 13].</li>
                    <li>Lower dropout rates (e.g., 9% vs 16% for some psychotherapies) suggest better patient retention [6].</li>
                    <li>Potentially cost-effective in some analyses [6].</li>
                </ul>
                <p class="mt-4 text-gray-700">Neurofeedback's distinct mechanism and favorable profile make it a powerful candidate to enhance overall PTSD treatment outcomes, especially for complex or treatment-resistant cases.</p>
            </div>
            <button class="summarize-btn bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300" data-target="context">‚ú® Summarize this Section</button>
            <div id="context-summary" class="llm-response"></div>
        </section>

        <section id="future" class="section-card scroll-mt-20">
            <h2 class="text-3xl font-bold mb-8 text-center">üî¨ Challenges & Future Research</h2>
            <p class="text-lg mb-6 text-center" id="future-text">Despite promising results, the field faces methodological limitations. Addressing these is key for broader clinical integration.</p>
            
            <div class="overflow-x-auto bg-white rounded-lg shadow">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Limitation Category</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Specific Limitation</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Future Research Recommendation</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Study Design</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Small sample sizes [1, 2, 3, 6, 17]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Larger, adequately powered RCTs.</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Controls</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Lack of robust placebo/sham controls [2, 6]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Adopt placebo-controlled or head-to-head designs.</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Blinding</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Lack of blinding (patients/clinicians) [3]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Implement robust blinding protocols.</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Follow-up</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Short follow-up periods [2, 6]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Design protocols with longer follow-up periods (>1 year).</td>
                        </tr>
                         <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Protocols</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Protocol heterogeneity; need for optimal dosing [7, 15, 16]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Establish standardized protocols, optimal dosage/duration.</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Economic Data</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Limited cost-effectiveness data [3]</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-700">Conduct comprehensive economic analyses (e.g., QALY).</td>
                        </tr>
                    </tbody>
                </table>
            </div>
             <p class="mt-6 text-gray-700 text-sm">Improving research quality, particularly in study design and standardization, is crucial for neurofeedback to transition from "promising" to an "established" and integrated PTSD treatment [3, 20].</p>
            <button id="generate-research-questions-btn" class="bg-sky-700 hover:bg-sky-800 text-white font-semibold py-2 px-4 rounded-md mt-4 transition duration-300">‚ú® Suggest Future Research Questions</button>
            <div id="future-questions-output" class="llm-response"></div>
        </section>

        <section id="conclusion" class="bg-slate-700 text-white py-12 sm:py-16 rounded-lg shadow-xl">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl sm:text-4xl font-bold mb-6 text-white">Conclusion: The Path Forward for Neurofeedback in PTSD Care</h2>
                <p class="text-lg sm:text-xl mb-4 max-w-3xl mx-auto text-slate-200">
                    Neurofeedback presents a compelling, non-invasive intervention for PTSD, supported by evidence of moderate to clinically meaningful efficacy, a favorable safety profile, and high patient tolerability.
                </p>
                <p class="text-lg sm:text-xl mb-4 max-w-3xl mx-auto text-slate-200">
                    The evolution towards more precise modalities like fMRI-informed EEG NF, coupled with regulatory approvals, signals its growing maturity. As research addresses current methodological limitations, neurofeedback is poised to become an integral part of personalized PTSD treatment, offering a unique path to neural self-regulation and lasting recovery.
                </p>
                 <p class="text-lg sm:text-xl font-semibold max-w-3xl mx-auto text-slate-100">
                    Continued investment in high-quality research is vital to fully realize its clinical potential and integrate it into mainstream practice and policy.
                </p>
            </div>
        </section>
    </main>

    <footer class="text-center py-8 mt-8 bg-gray-200">
        <p class="text-sm text-gray-600">This interactive application is based on the report "Neurofeedback for Posttraumatic Stress Disorder: An Evidence-Based Review." Content synthesized for educational and informational purposes.</p>
        <p class="text-sm text-gray-600">&copy; 2025 Interactive Clinical Insights (Conceptual)</p>
    </footer>

    <script>
        // Navigation scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const navHeight = document.getElementById('mainNav')?.offsetHeight || 0;
                    const elementPosition = targetElement.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - navHeight - 10;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });

                    document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Tab functionality for Modalities
        const tabs = document.querySelectorAll('.interactive-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(item => item.classList.remove('active'));
                tab.classList.add('active');

                const targetContentId = tab.dataset.tab + '-content';
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === targetContentId) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // Chart.js Label Wrapping and Tooltip Configuration
        const wrapLabel = (label, maxLength = 16) => {
            if (typeof label !== 'string' || label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            for (const word of words) {
                if ((currentLine + word).length > maxLength && currentLine.length > 0) {
                    lines.push(currentLine.trim());
                    currentLine = '';
                }
                currentLine += word + ' ';
            }
            lines.push(currentLine.trim());
            return lines;
        };

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            if (!item) return '';
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };
        
        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        title: tooltipTitleCallback,
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += context.parsed.y;
                                if (context.dataset.unit) label += context.dataset.unit;
                            }
                            return label;
                        }
                    },
                    backgroundColor: '#333333',
                    titleFont: { weight: 'bold', family: 'Inter' },
                    bodyFont: { family: 'Inter' },
                    padding: 10,
                    cornerRadius: 4,
                },
                legend: {
                    labels: {
                        font: { family: 'Inter', size: 12 },
                        color: '#333333'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { 
                        font: { family: 'Inter', size: 11 }, 
                        color: '#455A64',
                        callback: function(value) { return Number.isInteger(value) ? value : value.toFixed(1); } 
                    },
                    grid: { color: '#CFD8DC' }
                },
                x: {
                    ticks: {
                        font: { family: 'Inter', size: 11 },
                        color: '#455A64',
                        callback: function(value) {
                            const label = this.getLabelForValue(value);
                            return wrapLabel(label);
                        }
                    },
                    grid: { display: false }
                }
            }
        };

        // Effect Size Chart (Bar)
        const effectSizeCtx = document.getElementById('effectSizeChart')?.getContext('2d');
        if (effectSizeCtx) {
            new Chart(effectSizeCtx, {
                type: 'bar',
                data: {
                    labels: [
                        'Meta-analysis 1 (PTSD SMD) [1]', 
                        'Meta-analysis 2 (PTSD SMD) [19]', 
                        'CAPS-5 (SMD Pre-Post) [3,17]', 
                        'PCL-5 (SMD Pre-Post) [3]'
                    ],
                    datasets: [{
                        label: 'Effect Size (SMD)',
                        data: [1.76, 0.74, 0.74, 0.47],
                        backgroundColor: ['#607D8B', '#795548', '#8D6E63', '#A1887F'],
                        borderColor: ['#455A64', '#5D4037', '#6D4C41', '#795548'],
                        borderWidth: 1,
                        unit: ' (SMD)'
                    }]
                },
                options: { ...commonChartOptions, 
                    plugins: { ...commonChartOptions.plugins, tooltip: {callbacks: { ...commonChartOptions.plugins.tooltip.callbacks, 
                        label: (context) => `Effect Size: ${context.raw} SMD (Negative SMD indicates improvement)`} } } 
                }
            });
        }

        // Remission Rate Chart (Doughnut)
        const remissionRateCtx = document.getElementById('remissionRateChart')?.getContext('2d');
        if (remissionRateCtx) {
            new Chart(remissionRateCtx, {
                type: 'doughnut',
                data: {
                    labels: [
                        'NF Group (Meta-analysis) [1,8]', 
                        'Control Group (Meta-analysis) [1,8]', 
                        'Prism Study (FDA) [4]', 
                        'Clinical Trial 2023 (>60%) [7,16]'
                    ],
                    datasets: [{
                        label: 'Remission Rate',
                        data: [79.3, 24.4, 32, 60],
                        backgroundColor: ['#607D8B', '#BDBDBD', '#795548', '#8D6E63'],
                        borderColor: ['#FFFFFF'],
                        borderWidth: 2,
                        unit: '%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: tooltipTitleCallback,
                                label: function(context) {
                                    let label = context.chart.data.labels[context.dataIndex] || '';
                                    if (label) {
                                        label = wrapLabel(label, 25).join(' ');
                                    }
                                    if (context.parsed !== null) {
                                        label += ': ' + context.parsed + '%';
                                    }
                                    return label;
                                }
                            },
                            backgroundColor: '#333333',
                            titleFont: { weight: 'bold', family: 'Inter' },
                            bodyFont: { family: 'Inter' },
                            padding: 10,
                            cornerRadius: 4,
                        },
                        legend: {
                            position: 'bottom',
                            labels: { 
                                font: { family: 'Inter', size: 11 }, 
                                color: '#333333',
                                boxWidth: 15,
                                padding: 15,
                                 generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map(function(label, i) {
                                            const meta = chart.getDatasetMeta(0);
                                            const style = meta.controller.getStyle(i);
                                            return {
                                                text: wrapLabel(label, 20).join('\n'),
                                                fillStyle: style.backgroundColor,
                                                strokeStyle: style.borderColor,
                                                lineWidth: style.borderWidth,
                                                hidden: isNaN(data.datasets[0].data[i]) || meta.data[i].hidden,
                                                index: i
                                            };
                                        });
                                    }
                                    return [];
                                }
                            }
                        }
                    }
                }
            });
        }

        // Active nav link highlighting on scroll
        const sections = document.querySelectorAll("section[id], header[id]");
        window.addEventListener("scroll", navHighlighter);

        function navHighlighter() {
            let scrollY = window.pageYOffset;
            const navHeight = document.getElementById('mainNav')?.offsetHeight || 0;

            sections.forEach(current => {
                const sectionHeight = current.offsetHeight;
                const sectionTop = current.offsetTop - navHeight - 20;
                let sectionId = current.getAttribute("id");
                
                const targetLink = document.querySelector(".nav-link[href*=" + sectionId + "]");

                if (targetLink) {
                    if (sectionId === 'home' && scrollY < (document.querySelector('#understanding-nf')?.offsetTop || 200) - navHeight - 20) {
                        targetLink.classList.add("active");
                        document.querySelectorAll(".nav-link:not([href*=" + sectionId + "])").forEach(link => {
                            if (link) link.classList.remove("active"); // Null check for link
                        });
                    } else if (scrollY > sectionTop && scrollY <= sectionTop + sectionHeight){
                        document.querySelectorAll(".nav-link").forEach(link => {
                            if (link) link.classList.remove("active"); // Null check for link
                        });
                        targetLink.classList.add("active");
                    } else if (sectionId !== 'home') {
                        targetLink.classList.remove("active");
                    }
                }
            });
            if (scrollY < 50) {
                 document.querySelectorAll(".nav-link").forEach(link => {
                    if (link) link.classList.remove("active"); // Null check for link
                 });
                 const homeLink = document.querySelector(".nav-link[href*='home']");
                 if (homeLink) {
                    homeLink.classList.add("active");
                 }
            }
        }
        navHighlighter();

        // Gemini API Integration
        async function callGeminiAPI(prompt, outputElementId, buttonElement) {
            const outputElement = document.getElementById(outputElementId);
            if (!outputElement) {
                console.error("Output element not found:", outputElementId);
                return;
            }

            const originalButtonText = buttonElement.innerHTML;
            buttonElement.disabled = true;
            buttonElement.innerHTML = `<span class="loading-spinner"></span> Loading...`;
            outputElement.innerHTML = '';
            outputElement.classList.remove('active');

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    outputElement.innerHTML = text;
                    outputElement.classList.add('active');
                } else {
                    outputElement.innerHTML = 'Error: Could not generate response. Please try again.';
                    outputElement.classList.add('active');
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                outputElement.innerHTML = `Error: ${error.message}. Please check console for details.`;
                outputElement.classList.add('active');
                console.error('Error calling Gemini API:', error);
            } finally {
                buttonElement.innerHTML = originalButtonText;
                buttonElement.disabled = false;
            }
        }

        // Summarize Section buttons
        document.querySelectorAll('.summarize-btn').forEach(button => {
            button.addEventListener('click', () => {
                const targetSectionId = button.dataset.target;
                const sectionTextElement = document.getElementById(`${targetSectionId}-text`);
                const summaryOutputElementId = `${targetSectionId}-summary`;
                
                let sectionContent = '';
                if (sectionTextElement) {
                    sectionContent = sectionTextElement.innerText;
                } else {
                    const sectionDiv = document.getElementById(targetSectionId);
                    if (sectionDiv) {
                        const paragraphs = sectionDiv.querySelectorAll('p');
                        paragraphs.forEach(p => {
                            if (!p.closest('.llm-response') && !p.closest('.chart-container') && !p.closest('button')) {
                                sectionContent += p.innerText + '\n';
                            }
                        });
                        const listItems = sectionDiv.querySelectorAll('li');
                        listItems.forEach(li => {
                            sectionContent += li.innerText + '\n';
                        });
                    }
                }

                const prompt = `Summarize the following text about Neurofeedback for PTSD in 2-3 concise sentences:\n\n${sectionContent.trim()}`;
                callGeminiAPI(prompt, summaryOutputElementId, button);
            });
        });

        // Generate Future Research Questions button
        const generateQuestionsBtn = document.getElementById('generate-research-questions-btn');
        if (generateQuestionsBtn) {
            generateQuestionsBtn.addEventListener('click', () => {
                const futureSectionText = document.getElementById('future-text').innerText;
                const tableRows = document.querySelectorAll('#future table tbody tr');
                let limitationsText = '';
                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        const limitation = cells[1].innerText.trim();
                        const recommendation = cells[2].innerText.trim();
                        limitationsText += `- Limitation: "${limitation}", Recommendation: "${recommendation}".\n`;
                    }
                });

                const prompt = `Based on the following text about challenges and future research in Neurofeedback for PTSD, suggest 3-5 distinct, specific, and actionable research questions. Focus on addressing the identified limitations and advancing the field. Present them as a bulleted list.\n\nContext:\n${futureSectionText}\n\nLimitations and Recommendations:\n${limitationsText.trim()}`;
                callGeminiAPI(prompt, 'future-questions-output', generateQuestionsBtn);
            });
        }

        // Explain in Simpler Terms for Neurological Mechanisms
        const explainMechanismsBtn = document.getElementById('explain-mechanisms-btn');
        if (explainMechanismsBtn) {
            explainMechanismsBtn.addEventListener('click', () => {
                const mechanismsTextElement = document.getElementById('mechanisms-text');
                let fullMechanismsContent = mechanismsTextElement ? mechanismsTextElement.innerText + '\n' : '';
                
                document.querySelectorAll('#mechanisms .stat-box p').forEach(p => {
                    fullMechanismsContent += p.innerText + '\n';
                });

                const prompt = `Explain the following neurological mechanisms of Neurofeedback for PTSD in simple, easy-to-understand terms, suitable for someone without a medical background. Focus on clarity and avoid jargon where possible:\n\n${fullMechanismsContent.trim()}`;
                callGeminiAPI(prompt, 'mechanisms-simple-explanation', explainMechanismsBtn);
            });
        }

        // Ask a Question about Understanding PTSD & Neurofeedback
        const askQuestionUnderstandingBtn = document.getElementById('ask-question-understanding-btn');
        const questionInputUnderstanding = document.getElementById('question-input-understanding');
        if (askQuestionUnderstandingBtn && questionInputUnderstanding) {
            askQuestionUnderstandingBtn.addEventListener('click', () => {
                const userQuestion = questionInputUnderstanding.value.trim();
                if (!userQuestion) {
                    document.getElementById('understanding-question-output').innerHTML = '<p class="text-red-600">Please enter a question.</p>';
                    document.getElementById('understanding-question-output').classList.add('active');
                    return;
                }

                const understandingSectionText = document.getElementById('understanding-nf-text').innerText;
                const prompt = `Based on the following context about PTSD and Neurofeedback, answer the user's question concisely:\n\nContext:\n${understandingSectionText}\n\nUser Question: ${userQuestion}`;
                callGeminiAPI(prompt, 'understanding-question-output', askQuestionUnderstandingBtn);
            });
        }
    </script>
</body>
</html>
